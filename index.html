<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Puja Photo Booth — Couple / Shiv / Durga</title>
<style>
  :root{--bg:#0f1020;--panel:#17192e;--muted:#9aa3b2;--text:#f2f5f7;--accent:#ffb703;--ok:#0ea5e9;--warn:#ef4444}
  *{box-sizing:border-box}
  body{margin:0;background:#0c0d1a;color:var(--text);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  header{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  h1{font-size:20px;margin:0}
  .tag{font-size:11px;background:var(--accent);color:#00131e;border-radius:999px;padding:2px 8px}
  .grid{display:grid;grid-template-columns:420px 1fr;gap:14px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:#17192e;border:1px solid #232642;border-radius:16px;padding:14px}
  .stack{display:flex;flex-direction:column;gap:10px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  input[type=file],select,button,input[type=range]{background:#243046;color:#e9eef8;border:1px solid #2a3450;border-radius:10px;padding:10px 12px}
  .btn-accent{background:var(--ok);border-color:#0a84c2;color:#00131e;font-weight:600}
  .note{font-size:12px;color:var(--muted)}
  canvas{width:100%;height:auto;background:#000;border-radius:12px;touch-action:pinch-zoom pan-x pan-y}
  #status{margin:10px 0;padding:10px;border-radius:10px;background:#1b2236;border:1px solid #2b3a5e;color:#cfe1ff;display:none}
  #status.warn{background:#3a1b1b;border-color:#5e2b2b;color:#ffd3d3}
  #diag{margin:8px 0 0 0;font:12px/1.4 ui-monospace,Menlo,Consolas;color:#9ab4ff}
  #videoBox{position:fixed;right:10px;bottom:10px;background:#000;border:1px solid #2a3450;border-radius:8px;padding:4px;z-index:50;display:none}
  #video{width:200px;height:auto;border-radius:6px;background:#000}
</style>

<body>
<div class="wrap">
  <header><span class="tag">No-Server • No-Storage</span><h1>Puja Photo Booth</h1></header>
  <div id="status" role="status" aria-live="polite"></div>

  <div class="grid">
    <div class="card stack">
      <h3>Source</h3>
      <div class="row">
        <button id="startCam">Use Camera</button>
        <button id="flipCam">Flip Camera</button>
        <button id="stopCam">Stop Camera</button>
        <input id="uploadPhoto" type="file" accept="image/*"/>
      </div>
      <label><input type="checkbox" id="mirror" checked/> Mirror preview</label>

      <h3>Overlay</h3>
      <div class="row">
        <button id="chooseCouple">Couple (Shiv+Durga)</button>
        <button id="chooseShiv">Single (Shiv)</button>
        <button id="chooseDurga">Single (Durga)</button>
        <button id="noOverlay">No Overlay</button>
      </div>
      <div class="row">
        <label><input type="checkbox" id="showOverlay" checked/> Show Overlay</label>
        <label>Opacity <input id="overlayAlpha" type="range" min="0" max="100" value="100"/></label>
        <label><input type="checkbox" id="showRaw" checked/> Show Raw Video until ready</label>
      </div>
      <div class="note">Put transparent PNGs in <code>assets/</code>: <code>overlay-couple.png</code>, <code>overlay-shiv.png</code>, <code>overlay-durga.png</code>.</div>

      <h3>Position</h3>
      <div class="row">
        <label>Zoom <input id="zoom" type="range" min="50" max="300" value="100"/></label>
        <label>Rotate <input id="rotate" type="range" min="-20" max="20" value="0"/></label>
        <button id="resetView">Reset View</button>
      </div>

      <h3>Capture</h3>
      <div class="row">
        <select id="ratio">
          <option value="1" selected>1:1</option><option value="1.3333333">4:3</option>
          <option value="1.7777778">16:9</option><option value="0.75">3:4</option>
        </select>
        <button id="snap" class="btn-accent">Capture & Download</button>
      </div>
      <div class="note">Drag to move; pinch/scroll to zoom. All processing is local.</div>
      <div id="diag"></div>
    </div>

    <div class="card">
      <h3>Live Preview</h3>
      <canvas id="preview" width="960" height="960" aria-label="Photo booth preview"></canvas>
    </div>
  </div>
</div>

<!-- Mode chooser -->
<div id="modeModal" class="modal" role="dialog" aria-modal="true" aria-label="Choose mode" style="position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:40">
  <div style="background:#0b1430;border:1px solid #2a3b61;border-radius:16px;padding:18px;max-width:520px;width:92%">
    <h2 style="margin:0 0 6px 0">Who is in the photo?</h2>
    <div class="row" style="margin-top:8px">
      <button id="modeCouple">Couple (Shiv + Durga)</button>
      <button id="modeShiv">Single (Shiv)</button>
      <button id="modeDurga">Single (Durga)</button>
    </div>
    <p class="note" style="margin-top:10px">Change anytime from Overlay buttons.</p>
  </div>
</div>

<!-- Raw video box -->
<div id="videoBox"><video id="video" playsinline autoplay muted></video></div>

<script>
// (The full JavaScript part is included in my earlier long message.)
// Paste the full JS code here without truncation.
</script>
</body>
</html>